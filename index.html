<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ASM | Cortana Gen-3</title>
    <style>
        :root { --glow: #00f2ff; --bg: #02060a; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; display: flex; height: 100vh; margin: 0; }
        
        /* Tactical HUD Style */
        .hud-container { display: grid; grid-template-columns: 280px 1fr; width: 100%; padding: 20px; gap: 20px; }
        .sidebar { background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2); border-radius: 15px; padding: 20px; backdrop-filter: blur(10px); }
        .main-chat { display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        
        /* The "Core" Hologram */
        .orb { width: 120px; height: 120px; background: radial-gradient(circle, var(--glow) 0%, transparent 70%); border-radius: 50%; margin: 0 auto 20px; animation: breathe 3s infinite ease-in-out; }
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.2); opacity: 1; } }

        .chat-box { flex-grow: 1; overflow-y: auto; padding: 20px; font-size: 1.1rem; line-height: 1.6; }
        .input-area { background: rgba(255,255,255,0.05); border-radius: 50px; padding: 10px 25px; display: flex; align-items: center; border: 1px solid rgba(0,242,255,0.3); }
        input { background: transparent; border: none; color: white; flex-grow: 1; outline: none; font-size: 1rem; }
        
        .btn { cursor: pointer; background: none; border: none; font-size: 1.5rem; color: var(--glow); transition: 0.3s; }
        .btn:hover { transform: scale(1.2); text-shadow: 0 0 10px var(--glow); }
        .upload-zone { border: 1px dashed var(--glow); padding: 10px; border-radius: 10px; text-align: center; font-size: 0.8rem; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="hud-container">
        <aside class="sidebar">
            <div class="orb"></div>
            <h3 style="color:var(--glow); text-align:center;">ASM SYSTEMS</h3>
            <p id="status-display">> Status: Waiting for Data</p>
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                Drop CSV Here to Train
                <input type="file" id="fileInput" hidden accept=".csv">
            </div>
            <div id="file-status" style="margin-top:10px; font-size:0.7rem; opacity:0.6;"></div>
        </aside>

        <main class="main-chat">
            <div class="chat-box" id="chat">
                <div style="color:var(--glow)">[SYSTEM]: Cortana Neural Link Online.</div>
            </div>

            <div class="input-area">
                <input type="text" id="userInput" placeholder="Ask ASM about the star maps or mission data...">
                <button class="btn" id="voiceBtn">ðŸŽ¤</button>
                <button class="btn" id="sendBtn">âž¤</button>
            </div>
        </main>
    </div>

    <script>
        const API_URL = "http://localhost:8000";

        // --- 1. TRAINING (CSV Upload) ---
        document.getElementById('fileInput').onchange = async (e) => {
            const file = e.target.files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            document.getElementById('file-status').innerText = "Uploading & Indexing...";
            const res = await fetch(`${API_URL}/train`, { method: 'POST', body: formData });
            const data = await res.json();
            document.getElementById('file-status').innerText = `Learned ${data.rows_indexed} records from ${file.name}`;
            speak("Data ingestion complete. My memory has been updated with the new ASM parameters.");
        };

        // --- 2. ASKING (Text/Voice Prompt) ---
        async function askASM(query) {
            appendChat("You: " + query, 'user');
            const res = await fetch(`${API_URL}/ask`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ query })
            });
            const data = await res.json();
            speak(data.response);
        }

        // --- 3. OUTPUT & VOICE ---
        function speak(text) {
            appendChat("Cortana: " + text, 'ai');
            window.speechSynthesis.cancel();
            const speech = new SpeechSynthesisUtterance(text);
            speech.rate = 1.1;
            window.speechSynthesis.speak(speech);
        }

        function appendChat(text, type) {
            const div = document.createElement('div');
            div.style.marginBottom = "15px";
            div.style.color = type === 'ai' ? '#00f2ff' : '#fff';
            div.innerText = text;
            document.getElementById('chat').appendChild(div);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }

        // Voice Support
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        document.getElementById('voiceBtn').onclick = () => recognition.start();
        recognition.onresult = (e) => askASM(e.results[0][0].transcript);

        // Buttons
        document.getElementById('sendBtn').onclick = () => {
            const q = document.getElementById('userInput').value;
            if(q) { askASM(q); document.getElementById('userInput').value = ""; }
        };
    </script>
</body>
</html>
